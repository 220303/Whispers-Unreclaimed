<Page
    x:Class="烟尘记.Trace"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:烟尘记"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Name="trace"
    Title="Trace"
    d:DesignHeight="450"
    d:DesignWidth="800"
    Background="Black"
    Focusable="True"
    KeyDown="Page_KeyDown"
    Tag="program"
    mc:Ignorable="d">

    <Page.Resources>

        <!--  颜色资源  -->
        <Color x:Key="BorderColor">#8A0707</Color>
        <Color x:Key="GlowColor">#FFF77777</Color>
        <Color x:Key="TextColor">White</Color>
        <Color x:Key="TextHoverColor">#FF4500</Color>
        <Color x:Key="PressedBorderColor">#B22222</Color>
        <Color x:Key="TextShadowColor">#FF6347</Color>
        <Color x:Key="BackgroundColor">Black</Color>

        <!--  画刷资源  -->
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}" />
        <SolidColorBrush x:Key="TextBrush" Color="{StaticResource TextColor}" />
        <SolidColorBrush x:Key="PressedBorderBrush" Color="{StaticResource PressedBorderColor}" />
        <SolidColorBrush x:Key="BackgroundBrush" Color="{StaticResource BackgroundColor}" />

        <!--  魔法按钮样式  -->
        <Style TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <!--  背景层 - 增强光晕  -->
                            <Border
                                x:Name="BackgroundBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="2"
                                CornerRadius="4">
                                <Border.Effect>
                                    <DropShadowEffect
                                        x:Name="BorderGlow"
                                        BlurRadius="0"
                                        Opacity="0"
                                        ShadowDepth="0"
                                        Color="{StaticResource GlowColor}" />
                                </Border.Effect>
                            </Border>

                            <!--  内容层  -->
                            <Grid>

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1*" />
                                    <ColumnDefinition Width="4*" />
                                    <ColumnDefinition Width="1*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="1*" />
                                    <RowDefinition Height="4*" />
                                    <RowDefinition Height="1*" />
                                </Grid.RowDefinitions>

                                <Viewbox
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    Stretch="Uniform">
                                    <TextBlock
                                        x:Name="ButtonText"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Effect="{x:Null}"
                                        FontFamily="Palatino Linotype"
                                        FontSize="18"
                                        FontWeight="Bold"
                                        Foreground="{StaticResource TextBrush}"
                                        Text="{TemplateBinding Content}" />
                                </Viewbox>

                            </Grid>

                            <!--  粒子效果层  -->
                            <Canvas x:Name="ParticleCanvas" IsHitTestVisible="False" />

                        </Grid>

                        <ControlTemplate.Triggers>
                            <!--  鼠标悬停动画  -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ColorAnimation
                                                Storyboard.TargetName="ButtonText"
                                                Storyboard.TargetProperty="Foreground.Color"
                                                To="{StaticResource TextHoverColor}"
                                                Duration="0:0:0.5" />
                                            <DoubleAnimation
                                                Storyboard.TargetName="BorderGlow"
                                                Storyboard.TargetProperty="BlurRadius"
                                                To="25"
                                                Duration="0:0:0.5" />
                                            <DoubleAnimation
                                                Storyboard.TargetName="BorderGlow"
                                                Storyboard.TargetProperty="Opacity"
                                                To="1.0"
                                                Duration="0:0:0.5" />
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ButtonText" Storyboard.TargetProperty="Effect">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="{x:Null}" />
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.5">
                                                    <DiscreteObjectKeyFrame.Value>
                                                        <DropShadowEffect
                                                            BlurRadius="12"
                                                            Opacity="0.8"
                                                            ShadowDepth="0"
                                                            Color="{StaticResource TextShadowColor}" />
                                                    </DiscreteObjectKeyFrame.Value>
                                                </DiscreteObjectKeyFrame>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>

                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ColorAnimation
                                                Storyboard.TargetName="ButtonText"
                                                Storyboard.TargetProperty="Foreground.Color"
                                                To="{StaticResource TextColor}"
                                                Duration="0:0:1" />
                                            <DoubleAnimation
                                                Storyboard.TargetName="BorderGlow"
                                                Storyboard.TargetProperty="BlurRadius"
                                                To="0"
                                                Duration="0:0:1" />
                                            <DoubleAnimation
                                                Storyboard.TargetName="BorderGlow"
                                                Storyboard.TargetProperty="Opacity"
                                                To="0"
                                                Duration="0:0:1" />
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ButtonText" Storyboard.TargetProperty="Effect">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0">
                                                    <DiscreteObjectKeyFrame.Value>
                                                        <DropShadowEffect
                                                            BlurRadius="12"
                                                            Opacity="0.8"
                                                            ShadowDepth="0"
                                                            Color="{StaticResource TextShadowColor}" />
                                                    </DiscreteObjectKeyFrame.Value>
                                                </DiscreteObjectKeyFrame>
                                                <DiscreteObjectKeyFrame KeyTime="0:0:1" Value="{x:Null}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>

                            <!--  按下效果  -->
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{StaticResource PressedBorderBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>

            <Setter Property="Background" Value="{StaticResource BackgroundBrush}" />
            <Setter Property="Padding" Value="15,8" />
            <Setter Property="TextElement.Foreground" Value="{StaticResource TextBrush}" />
        </Style>

        <!--  ListBox亚克力资源  -->
        <BlurEffect
            x:Key="AcrylicEffect"
            KernelType="Gaussian"
            Radius="8" />

    </Page.Resources>

    <!--  页面总Grid  -->
    <Grid x:Name="Total_grid">

        <!--  自定义控件用于绘制边框  -->
        <local:MagicCornerBorder_Trace
            x:Name="Border_drawer"
            Background="Transparent"
            IsHitTestVisible="False" />

        <!--  页面内容  -->
        <Grid x:Name="Content_grid">
            <Grid.RowDefinitions>
                <RowDefinition Height="4*" />
                <RowDefinition Height="45*" />
                <RowDefinition Height="2*" />
                <RowDefinition Height="5*" />
                <RowDefinition Height="4*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="50*" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>


            <ListBox
                x:Name="Saves_ListBox"
                Grid.Row="1"
                Grid.Column="1"
                Background="Transparent"
                BorderThickness="0"
                Foreground="{x:Null}"
                ScrollViewer.VerticalScrollBarVisibility="Disabled"
                ItemsSource="{x:Static local:Save.saves}"
                SelectionChanged="Saves_ListBox_SelectionChanged">

                <!--  添加虚拟化面板提高性能  -->
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel Orientation="Vertical" />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>

                <!--  Item的容器Template  -->
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="BorderBrush" Value="Transparent" />
                        <Setter Property="Margin" Value="10,5" />
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">

                                    <Border
                                        x:Name="Bd"
                                        Padding="0"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        CornerRadius="1"
                                        SnapsToDevicePixels="true">

                                        <Grid>
                                            <Rectangle Effect="{StaticResource AcrylicEffect}" IsHitTestVisible="False" />
                                            <ContentPresenter />
                                        </Grid>

                                    </Border>

                                    <ControlTemplate.Triggers>
                                        <!--  鼠标悬停效果  -->
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="#30FFFFFF" />
                                            <Setter TargetName="Bd" Property="BorderBrush" Value="#FFCC5656" />
                                        </Trigger>
                                        <!--  选中效果  -->
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Bd" Property="BorderBrush" Value="#8A0707" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>

                <!--  Item的数据Template  -->
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <!--  存档项容器  -->
                        <Border
                            Height="50"
                            Margin="5,10"
                            CornerRadius="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1*" />
                                    <ColumnDefinition Width="4*" />
                                    <ColumnDefinition Width="8*" />
                                    <ColumnDefinition Width="4*" />
                                    <ColumnDefinition Width="1*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="1*" />
                                    <RowDefinition Height="4*" />
                                    <RowDefinition Height="1*" />
                                </Grid.RowDefinitions>

                                
                                <!--  存档名称  -->
                                <Viewbox
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Stretch="Uniform">
                                    <TextBlock
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        FontFamily="/Filesystem/Resource/Font/剧情.ttf#QFKT"
                                        FontWeight="Bold"
                                        Foreground="White"
                                        Text="{Binding Name}" />
                                </Viewbox>

                                <!--  创建时间  -->
                                <Viewbox
                                    Grid.Row="1"
                                    Grid.Column="3"
                                    Stretch="Uniform">
                                    <TextBlock
                                        Grid.Row="1"
                                        Grid.Column="3"
                                        FontFamily="Palatino Linotype"
                                        Foreground="White"
                                        Text="{Binding Save_creation_time}" />
                                </Viewbox>



                            </Grid>
                        </Border>



                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>






            <!--  按钮Grid  -->
            <Grid
                x:Name="Button_grid"
                Grid.Row="3"
                Grid.Column="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="3*" />
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>

                <Button
                    Name="New_save"
                    Grid.Column="1"
                    Click="New_save_Click"
                    Content="新建存档" />
                <Button
                    Name="Delete_save"
                    Grid.Row="3"
                    Grid.RowSpan="2"
                    Grid.Column="3"
                    Click="Delete_save_Click"
                    Content="删除存档" />
            </Grid>
        </Grid>
    </Grid>

</Page>
